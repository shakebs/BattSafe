<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>EV Battery Intelligence | Web Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&family=JetBrains+Mono:wght@500&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js" defer></script>
</head>

<body>
  <div class="bg-glow"></div>

  <header class="topbar">
    <div>
      <p class="eyebrow">V2 Demo Web Build <span id="modeBadge" class="mode-badge">SIM</span></p>
      <h1>EV Battery Thermal Runaway Prevention Dashboard</h1>
      <p class="subtitle" id="scenarioLabel">Scenario: Normal Operation</p>
      <p class="bridge-status idle" id="bridgeStatus">Bridge: waiting for input</p>
      <div class="signal-stats">
        <span class="signal-stat"
          title="Full-scale: 104 group voltages + 19 NTCs + gas/pressure/swelling = 131+ channels">
          <strong id="signalCount">131</strong> Signals Processed
        </span>
        <span class="signal-stat-sep">|</span>
        <span class="signal-stat">
          <strong id="samplingRate">10</strong> Hz Sampling
        </span>
        <span class="signal-stat-sep">|</span>
        <span class="signal-stat">
          <strong>5</strong> Sensor Categories
        </span>
        <span class="signal-stat-sep">|</span>
        <span class="signal-stat signal-stat-link">
          <a href="http://localhost:5001" target="_blank" title="Open full-scale 104S8P digital twin simulator">ðŸ”—
            Full-Scale Twin â†’</a>
        </span>
      </div>
    </div>
    <div class="controls">
      <label class="speed">
        Mode
        <select id="inputModeSelect">
          <option value="timeline" selected>Timeline</option>
          <option value="manual">Manual</option>
        </select>
      </label>
      <button id="detectBtn" class="btn ghost">Detect Board</button>
      <button id="toggleBtn" class="btn primary">Pause</button>
      <button id="resetBtn" class="btn ghost">Reset</button>
      <label class="speed">
        Speed
        <select id="speedSelect">
          <option value="220">0.5x</option>
          <option value="120" selected>1x</option>
          <option value="70">2x</option>
          <option value="40">4x</option>
        </select>
      </label>
    </div>
  </header>

  <main class="grid">
    <section class="card full manual-card" id="manualCard">
      <h2>[M] Manual Fault Injection</h2>
      <div class="manual-grid">
        <label>Voltage (V)<input id="mVoltage" type="number" step="0.1" value="14.8"></label>
        <label>Current (A)<input id="mCurrent" type="number" step="0.1" value="2.1"></label>
        <label>Max Cell Temp (C)<input id="mTemp" type="number" step="0.1" value="28"></label>
        <label>Gas Ratio<input id="mGas" type="number" step="0.01" value="0.98"></label>
        <label>Pressure Delta (hPa)<input id="mPressure" type="number" step="0.1" value="0"></label>
        <label>Swelling (%)<input id="mSwelling" type="number" step="0.1" value="2"></label>
      </div>
      <div class="manual-actions">
        <select id="presetSelect">
          <option value="normal">Preset: Normal</option>
          <option value="thermal">Preset: Thermal</option>
          <option value="gas">Preset: Gas</option>
          <option value="critical">Preset: Critical (2-cat)</option>
          <option value="emergency">Preset: Emergency (3-cat)</option>
          <option value="short">Preset: Short Circuit</option>
        </select>
        <button id="loadPresetBtn" class="btn ghost">Load Preset</button>
        <button id="applyManualBtn" class="btn primary">Apply Values</button>
      </div>
      <p class="manual-note">
        Manual mode reuses the same anomaly + correlation logic. Emergency remains latched until reset.
      </p>
    </section>

    <section class="card full">
      <h2>Processing Output</h2>
      <div class="outputs-grid">
        <div class="output-block output-raw raw-state-normal" id="outRawPanel">
          <h3>Raw Data Trends (From 5001)</h3>
          <div class="raw-kpi-grid">
            <div class="raw-kpi">
              <span>Pack Voltage</span>
              <strong id="rawPackVoltage">â€”</strong>
            </div>
            <div class="raw-kpi">
              <span>Pack Current</span>
              <strong id="rawPackCurrent">â€”</strong>
            </div>
            <div class="raw-kpi">
              <span>Cell Temp</span>
              <strong id="rawCellTemp">â€”</strong>
            </div>
            <div class="raw-kpi">
              <span>Gas Ratio</span>
              <strong id="rawGasRatio">â€”</strong>
            </div>
            <div class="raw-kpi">
              <span>Pressure Î”</span>
              <strong id="rawPressureDelta">â€”</strong>
            </div>
            <div class="raw-kpi">
              <span>Swelling</span>
              <strong id="rawSwellingPct">â€”</strong>
            </div>
          </div>
          <div class="mini-chart-wrap">
            <canvas id="rawElectricalChart" width="980" height="220"></canvas>
          </div>
          <div class="mini-chart-wrap">
            <canvas id="rawThermalChart" width="980" height="220"></canvas>
          </div>
          <div class="mini-chart-wrap">
            <canvas id="rawGasChart" width="980" height="220"></canvas>
          </div>
        </div>

        <div class="output-block output-detection detect-normal" id="outDetection">
          <h3>Intelligent Detection (Board)</h3>
          <div class="detect-summary">
            <div class="detect-item">
              <span>System State</span>
              <strong id="detectState">â€”</strong>
            </div>
            <div class="detect-item">
              <span>Anomaly Count</span>
              <strong id="detectAnomalyCount">0</strong>
            </div>
            <div class="detect-item">
              <span>Emergency Direct</span>
              <strong id="detectEmergencyDirect">No</strong>
            </div>
          </div>
          <div class="detect-categories">
            <span id="detectCategoryEmpty">No active categories</span>
            <div id="detectCategoryList" class="detect-category-list"></div>
          </div>
        </div>

        <div class="output-block output-risk risk-normal" id="outThermalRisk">
          <h3>Thermal Runaway & Cascade</h3>
          <div class="risk-top">
            <span class="risk-level-label">Risk Level</span>
            <span class="risk-level-pill" id="outRiskStatus">Normal</span>
          </div>
          <div class="risk-bar-bg">
            <div class="risk-bar-fill" id="outRiskBar"></div>
          </div>
          <div class="risk-stage-box">
            <div class="risk-stage-name" id="outStageName">Normal</div>
            <div class="risk-stage-desc" id="outStageDesc">All parameters within spec</div>
          </div>
          <div class="risk-hotspot-grid">
            <div class="risk-hotspot-item">
              <span>Hottest Cell</span>
              <strong id="outHottestCell">â€”</strong>
            </div>
            <div class="risk-hotspot-item">
              <span>Peak Temp</span>
              <strong id="outHottestTemp">â€”</strong>
            </div>
            <div class="risk-hotspot-item">
              <span>Max dT/dt</span>
              <strong id="outHottestDtDt">â€”</strong>
            </div>
          </div>
          <div class="risk-cascade-title">Cascade Timeline</div>
          <div id="outCascadeStages" class="cascade-stage-list"></div>
        </div>
      </div>
    </section>

  </main>

  <footer>
    Prototype mirrors firmware 7-scenario cycle (215s).
    Full-scale: 104Ã—V + 19Ã—NTC + 2Ã—Gas + 2Ã—Î”P + 8Ã—Swell = 131+ channels @ 10 Hz.
    <a href="http://localhost:5001" target="_blank" style="color:#7dd3fc;text-decoration:none;">Open Digital Twin â†’</a>
  </footer>

  <script src="./app.js"></script>
</body>

</html>
